<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå - Punnett Square</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: 'Sarabun', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .genotype-cell {
            transition: transform 0.2s;
        }
        .genotype-cell:hover {
            transform: scale(1.05);
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-blue-50 min-h-screen p-4">
    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <div class="flex items-center gap-3 mb-2">
                <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path>
                </svg>
                <h1 class="text-3xl font-bold text-gray-800">‡πÄ‡∏Å‡∏°‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå</h1>
            </div>
            <p class="text-gray-600">Punnett Square Simulation - ‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏ó‡∏≠‡∏î‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°</p>
        </div>

        <!-- Disease Selection -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏£‡∏Ñ</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4" id="diseaseButtons">
                <!-- Disease buttons will be inserted here -->
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Parent Selection -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="flex items-center gap-2 mb-4">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                    </svg>
                    <h2 class="text-xl font-bold text-gray-800">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏µ‡πÇ‡∏ô‡πÑ‡∏ó‡∏õ‡πå‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà</h2>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">‡∏û‡πà‡∏≠ (‚ôÇ)</label>
                        <div class="flex gap-2" id="parent1Buttons"></div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">‡πÅ‡∏°‡πà (‚ôÄ)</label>
                        <div class="flex gap-2" id="parent2Buttons"></div>
                    </div>

                    <button onclick="calculateResults()" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition-colors flex items-center justify-center gap-2">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd"></path>
                        </svg>
                        ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏• Punnett Square
                    </button>
                </div>

                <!-- Legend -->
                <div class="mt-6 p-4 bg-gray-50 rounded-lg">
                    <h3 class="font-bold text-sm text-gray-700 mb-2">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå:</h3>
                    <div class="space-y-1 text-sm" id="legend"></div>
                </div>
            </div>

            <!-- Punnett Square Results -->
            <div id="resultsSection" class="bg-white rounded-lg shadow-lg p-6" style="display: none;">
                <h2 class="text-xl font-bold text-gray-800 mb-4">‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå Punnett Square</h2>
                
                <!-- Punnett Square Grid -->
                <div class="mb-6" id="punnettGrid"></div>

                <!-- Probability -->
                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-bold text-gray-800 mb-3">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô:</h3>
                    <div class="space-y-2" id="probability"></div>
                </div>
            </div>
        </div>

        <!-- Random Simulation -->
        <div id="simulationSection" class="bg-white rounded-lg shadow-lg p-6 mt-6" style="display: none;">
            <h2 class="text-xl font-bold text-gray-800 mb-4">‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°</h2>
            <p class="text-gray-600 mb-4">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ú‡∏™‡∏°‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡πå‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏° (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÇ‡∏¢‡∏ô‡πÄ‡∏´‡∏£‡∏µ‡∏¢‡∏ç/‡∏•‡∏π‡∏Å‡πÄ‡∏ï‡πâ‡∏≤)</p>
            
            <div class="flex gap-4 mb-4">
                <button onclick="simulateOnce()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                    üé≤ ‡∏™‡∏∏‡πà‡∏° 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
                <button onclick="simulateMultiple()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
                    üé≤ ‡∏™‡∏∏‡πà‡∏° 10 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á
                </button>
                <button onclick="resetSimulation()" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-6 rounded-lg transition-colors flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
                </button>
            </div>

            <div id="trialsResults" style="display: none;">
                <p class="font-bold text-gray-700 mb-2">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á (<span id="trialCount">0</span> ‡∏Ñ‡∏£‡∏±‡πâ‡∏á):</p>
                <div class="flex flex-wrap gap-2 mb-4" id="trialsList"></div>

                <div class="bg-gray-50 rounded-lg p-4">
                    <h3 class="font-bold text-gray-800 mb-3">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏•‡∏≠‡∏á:</h3>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="trialsSummary"></div>
                </div>
            </div>
        </div>

        <!-- Sex Determination Section -->
        <div id="sexSection" class="bg-white rounded-lg shadow-lg p-6 mt-6" style="display: none;">
            <h2 class="text-xl font-bold text-gray-800 mb-4">üß¨ ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏û‡∏® (Sex Determination)</h2>
            <p class="text-gray-600 mb-4">‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏û‡∏®‡πÉ‡∏ô‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå‡∏Ç‡∏∂‡πâ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏°‡πÄ‡∏û‡∏® X ‡πÅ‡∏•‡∏∞ Y</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Punnett Square for Sex -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">Punnett Square ‡πÄ‡∏û‡∏®</h3>
                    <div class="inline-block border-2 border-gray-400">
                        <div class="flex">
                            <div class="w-16 h-16 border-r-2 border-b-2 border-gray-400 bg-gray-100"></div>
                            <div class="w-24 h-16 border-r-2 border-b-2 border-gray-400 bg-pink-50 flex items-center justify-center">
                                <span class="font-mono font-bold text-pink-700">X</span>
                            </div>
                            <div class="w-24 h-16 border-b-2 border-gray-400 bg-pink-50 flex items-center justify-center">
                                <span class="font-mono font-bold text-pink-700">X</span>
                            </div>
                        </div>
                        <div class="flex">
                            <div class="w-16 h-24 border-r-2 border-b-2 border-gray-400 bg-blue-50 flex items-center justify-center">
                                <span class="font-mono font-bold text-blue-700">X</span>
                            </div>
                            <div class="w-24 h-24 border-r-2 border-b-2 border-gray-400 bg-pink-100 border-pink-400 border-2 flex flex-col items-center justify-center">
                                <span class="font-mono font-bold text-lg">XX</span>
                                <span class="text-xs font-semibold text-pink-700">‚ôÄ ‡∏´‡∏ç‡∏¥‡∏á</span>
                            </div>
                            <div class="w-24 h-24 border-r-2 border-b-2 border-gray-400 bg-pink-100 border-pink-400 border-2 flex flex-col items-center justify-center">
                                <span class="font-mono font-bold text-lg">XX</span>
                                <span class="text-xs font-semibold text-pink-700">‚ôÄ ‡∏´‡∏ç‡∏¥‡∏á</span>
                            </div>
                        </div>
                        <div class="flex">
                            <div class="w-16 h-24 border-r-2 border-gray-400 bg-blue-50 flex items-center justify-center">
                                <span class="font-mono font-bold text-blue-700">Y</span>
                            </div>
                            <div class="w-24 h-24 border-r-2 border-gray-400 bg-blue-100 border-blue-400 border-2 flex flex-col items-center justify-center">
                                <span class="font-mono font-bold text-lg">XY</span>
                                <span class="text-xs font-semibold text-blue-700">‚ôÇ ‡∏ä‡∏≤‡∏¢</span>
                            </div>
                            <div class="w-24 h-24 border-r-2 border-gray-400 bg-blue-100 border-blue-400 border-2 flex flex-col items-center justify-center">
                                <span class="font-mono font-bold text-lg">XY</span>
                                <span class="text-xs font-semibold text-blue-700">‚ôÇ ‡∏ä‡∏≤‡∏¢</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sex Probability -->
                <div>
                    <h3 class="font-semibold text-gray-800 mb-3">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô</h3>
                    <div class="space-y-3">
                        <div class="bg-pink-50 border-2 border-pink-400 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-lg">‚ôÄ ‡πÄ‡∏û‡∏®‡∏´‡∏ç‡∏¥‡∏á (XX)</span>
                                <span class="text-2xl font-bold text-pink-600">50%</span>
                            </div>
                            <p class="text-sm text-gray-600">2/4 = 50%</p>
                        </div>
                        <div class="bg-blue-50 border-2 border-blue-400 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-2">
                                <span class="font-bold text-lg">‚ôÇ ‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢ (XY)</span>
                                <span class="text-2xl font-bold text-blue-600">50%</span>
                            </div>
                            <p class="text-sm text-gray-600">2/4 = 50%</p>
                        </div>
                    </div>

                    <div class="mt-4 p-4 bg-gray-50 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-2">üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</h4>
                        <ul class="text-sm text-gray-600 space-y-1 list-disc list-inside">
                            <li>‡∏û‡πà‡∏≠ (XY) ‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏° X ‡∏´‡∏£‡∏∑‡∏≠ Y</li>
                            <li>‡πÅ‡∏°‡πà (XX) ‡πÉ‡∏´‡πâ‡πÇ‡∏Ñ‡∏£‡πÇ‡∏°‡πÇ‡∏ã‡∏° X ‡πÄ‡∏™‡∏°‡∏≠</li>
                            <li>‡πÄ‡∏û‡∏®‡∏ä‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ç‡∏¥‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏≠‡∏™‡∏∏‡∏à‡∏¥‡∏à‡∏≤‡∏Å‡∏û‡πà‡∏≠</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Combined Probability -->
            <div class="mt-6 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6 border-2 border-purple-300">
                <h3 class="font-bold text-lg text-gray-800 mb-4">üéØ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏ß‡∏°: ‡πÇ‡∏£‡∏Ñ + ‡πÄ‡∏û‡∏®</h3>
                <div id="combinedProbability" class="grid grid-cols-2 md:grid-cols-4 gap-3"></div>
            </div>
        </div>
    </div>

    <script>
        // Disease data
        const diseases = [
            {
                id: 'thalassemia',
                name: '‡∏ó‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢ (Thalassemia)',
                type: '‡∏î‡πâ‡∏≠‡∏¢ (Recessive)',
                dominantAllele: 'T',
                recessiveAllele: 't',
                affected: 'tt',
                carrier: 'Tt',
                normal: 'TT',
                description: '‡πÇ‡∏£‡∏Ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏ò‡∏≤‡∏•‡∏±‡∏™‡∏ã‡∏µ‡πÄ‡∏°‡∏µ‡∏¢ - ‡∏Ç‡∏≤‡∏î‡∏Æ‡∏µ‡πÇ‡∏°‡πÇ‡∏Å‡∏•‡∏ö‡∏¥‡∏ô',
                details: '‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ú‡∏•‡∏¥‡∏ï‡∏Æ‡∏µ‡πÇ‡∏°‡πÇ‡∏Å‡∏•‡∏ö‡∏¥‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡πÇ‡∏£‡∏Ñ‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á ‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏°‡∏µ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏≠‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏•‡∏µ‡∏¢ ‡∏ã‡∏µ‡∏î ‡πÅ‡∏•‡∏∞‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡πÄ‡∏•‡∏∑‡∏≠‡∏î'
            },
            {
                id: 'albinism',
                name: '‡∏ú‡∏¥‡∏ß‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å (Albinism)',
                type: '‡∏î‡πâ‡∏≠‡∏¢ (Recessive)',
                dominantAllele: 'A',
                recessiveAllele: 'a',
                affected: 'aa',
                carrier: 'Aa',
                normal: 'AA',
                description: '‡∏Ç‡∏≤‡∏î‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡πÄ‡∏°‡∏•‡∏≤‡∏ô‡∏¥‡∏ô',
                details: '‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡πá‡∏î‡∏™‡∏µ‡πÄ‡∏°‡∏•‡∏≤‡∏ô‡∏¥‡∏ô‡πÑ‡∏î‡πâ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á ‡∏ú‡∏° ‡πÅ‡∏•‡∏∞‡∏ï‡∏≤‡∏ã‡∏µ‡∏î‡∏à‡∏±‡∏î ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏à‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏¢‡∏≤‡∏Å ‡πÅ‡∏•‡∏∞‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏°‡∏∞‡πÄ‡∏£‡πá‡∏á‡∏ú‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏π‡∏á'
            },
            {
                id: 'achondroplasia',
                name: '‡∏≠‡∏∞‡∏Ñ‡∏≠‡∏ô‡πÇ‡∏î‡∏£‡∏û‡∏•‡∏≤‡πÄ‡∏ã‡∏µ‡∏¢ (Achondroplasia)',
                type: '‡πÄ‡∏î‡πà‡∏ô (Dominant)',
                dominantAllele: 'D',
                recessiveAllele: 'd',
                affected: 'Dd',
                normal: 'dd',
                carrier: '-',
                description: '‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏≤‡∏™‡∏±‡πâ‡∏ô (‡∏Ñ‡∏ô‡πÅ‡∏Ñ‡∏£‡∏∞)',
                details: '‡πÇ‡∏£‡∏Ñ‡∏ó‡∏≤‡∏á‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡πÅ‡∏Ç‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡∏≤‡πÄ‡∏à‡∏£‡∏¥‡∏ç‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏™‡∏±‡πâ‡∏ô‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏™‡πà‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏£‡πà‡∏≤‡∏á‡πÄ‡∏ï‡∏µ‡πâ‡∏¢ ‡πÅ‡∏ï‡πà‡∏°‡∏µ‡∏™‡∏ï‡∏¥‡∏õ‡∏±‡∏ç‡∏ç‡∏≤‡∏õ‡∏Å‡∏ï‡∏¥'
            }
        ];

        let selectedDisease = diseases[0];
        let parent1 = 'Aa';
        let parent2 = 'Aa';
        let trials = [];

        // Initialize
        function init() {
            renderDiseaseButtons();
            updateParentButtons();
            updateLegend();
        }

        function renderDiseaseButtons() {
            const container = document.getElementById('diseaseButtons');
            container.innerHTML = diseases.map(disease => `
                <button onclick="selectDisease('${disease.id}')" 
                    id="disease-${disease.id}"
                    class="p-4 rounded-lg border-2 transition-all ${selectedDisease.id === disease.id ? 'border-purple-600 bg-purple-50' : 'border-gray-200 hover:border-purple-300'}">
                    <h3 class="font-bold text-lg mb-1">${disease.name}</h3>
                    <p class="text-sm text-gray-600">${disease.type}</p>
                    <p class="text-xs text-gray-500 mt-2">${disease.description}</p>
                    <p class="text-xs text-gray-600 mt-2 text-left leading-relaxed">${disease.details}</p>
                </button>
            `).join('');
        }

        function selectDisease(diseaseId) {
            selectedDisease = diseases.find(d => d.id === diseaseId);
            parent1 = selectedDisease.dominantAllele + selectedDisease.recessiveAllele;
            parent2 = selectedDisease.dominantAllele + selectedDisease.recessiveAllele;
            trials = [];
            
            renderDiseaseButtons();
            updateParentButtons();
            updateLegend();
            hideResults();
        }

        function getAlleleOptions(disease) {
            const D = disease.dominantAllele;
            const r = disease.recessiveAllele;
            return [`${D}${D}`, `${D}${r}`, `${r}${r}`];
        }

        function updateParentButtons() {
            const options = getAlleleOptions(selectedDisease);
            
            document.getElementById('parent1Buttons').innerHTML = options.map(opt => `
                <button onclick="setParent1('${opt}')" 
                    class="px-4 py-2 rounded-lg font-mono font-bold border-2 transition-all ${parent1 === opt ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-200 hover:border-blue-300'}">
                    ${opt}
                </button>
            `).join('');

            document.getElementById('parent2Buttons').innerHTML = options.map(opt => `
                <button onclick="setParent2('${opt}')" 
                    class="px-4 py-2 rounded-lg font-mono font-bold border-2 transition-all ${parent2 === opt ? 'border-pink-600 bg-pink-50 text-pink-700' : 'border-gray-200 hover:border-pink-300'}">
                    ${opt}
                </button>
            `).join('');
        }

        function setParent1(genotype) {
            parent1 = genotype;
            updateParentButtons();
            hideResults();
        }

        function setParent2(genotype) {
            parent2 = genotype;
            updateParentButtons();
            hideResults();
        }

        function updateLegend() {
            let legendHTML = `
                <p><span class="font-mono font-bold">${selectedDisease.dominantAllele}</span> = ‡∏≠‡∏±‡∏•‡∏•‡∏µ‡∏•‡πÄ‡∏î‡πà‡∏ô</p>
                <p><span class="font-mono font-bold">${selectedDisease.recessiveAllele}</span> = ‡∏≠‡∏±‡∏•‡∏•‡∏µ‡∏•‡∏î‡πâ‡∏≠‡∏¢</p>
            `;
            document.getElementById('legend').innerHTML = legendHTML;
        }

        function sortGenotype(genotype) {
            const chars = genotype.split('');
            chars.sort((a, b) => {
                if (a === selectedDisease.dominantAllele) return -1;
                if (b === selectedDisease.dominantAllele) return 1;
                return 0;
            });
            return chars.join('');
        }

        function calculatePunnett() {
            const p1a1 = parent1[0];
            const p1a2 = parent1[1];
            const p2a1 = parent2[0];
            const p2a2 = parent2[1];

            return [
                [sortGenotype(p1a1 + p2a1), sortGenotype(p1a1 + p2a2)],
                [sortGenotype(p1a2 + p2a1), sortGenotype(p1a2 + p2a2)]
            ];
        }

        function getPhoenotype(genotype) {
            const disease = selectedDisease;
            
            if (disease.type.includes('‡∏î‡πâ‡∏≠‡∏¢')) {
                if (genotype === disease.affected) 
                    return { status: '‡∏õ‡πà‡∏ß‡∏¢', color: 'bg-red-100 border-red-400', text: 'text-red-700' };
                if (genotype === disease.carrier) 
                    return { status: '‡∏û‡∏≤‡∏´‡∏∞', color: 'bg-yellow-100 border-yellow-400', text: 'text-yellow-700' };
                return { status: '‡∏õ‡∏Å‡∏ï‡∏¥', color: 'bg-green-100 border-green-400', text: 'text-green-700' };
            } else {
                if (genotype === disease.affected) 
                    return { status: '‡∏õ‡πà‡∏ß‡∏¢', color: 'bg-red-100 border-red-400', text: 'text-red-700' };
                return { status: '‡∏õ‡∏Å‡∏ï‡∏¥', color: 'bg-green-100 border-green-400', text: 'text-green-700' };
            }
        }

        function calculateResults() {
            const results = calculatePunnett();
            
            // Render Punnett Square
            let gridHTML = `
                <div class="inline-block border-2 border-gray-400">
                    <div class="flex">
                        <div class="w-16 h-16 border-r-2 border-b-2 border-gray-400 bg-gray-100"></div>
                        <div class="w-24 h-16 border-r-2 border-b-2 border-gray-400 bg-blue-50 flex items-center justify-center">
                            <span class="font-mono font-bold text-blue-700">${parent2[0]}</span>
                        </div>
                        <div class="w-24 h-16 border-b-2 border-gray-400 bg-blue-50 flex items-center justify-center">
                            <span class="font-mono font-bold text-blue-700">${parent2[1]}</span>
                        </div>
                    </div>
            `;

            results.forEach((row, i) => {
                gridHTML += `<div class="flex">
                    <div class="w-16 h-24 border-r-2 border-gray-400 bg-pink-50 flex items-center justify-center">
                        <span class="font-mono font-bold text-pink-700">${parent1[i]}</span>
                    </div>`;
                
                row.forEach(cell => {
                    const pheno = getPhoenotype(cell);
                    gridHTML += `
                        <div class="genotype-cell w-24 h-24 border-r-2 border-gray-400 ${pheno.color} border-2 flex flex-col items-center justify-center">
                            <span class="font-mono font-bold text-lg">${cell}</span>
                            <span class="text-xs font-semibold ${pheno.text}">${pheno.status}</span>
                        </div>
                    `;
                });
                
                gridHTML += '</div>';
            });

            gridHTML += '</div>';
            document.getElementById('punnettGrid').innerHTML = gridHTML;

            // Calculate probability
            const counts = { '‡∏õ‡∏Å‡∏ï‡∏¥': 0, '‡∏û‡∏≤‡∏´‡∏∞': 0, '‡∏õ‡πà‡∏ß‡∏¢': 0 };
            results.flat().forEach(genotype => {
                const pheno = getPhoenotype(genotype);
                counts[pheno.status]++;
            });

            let probHTML = '';
            Object.entries(counts).forEach(([status, count]) => {
                if (count > 0) {
                    const percentage = ((count / 4) * 100).toFixed(0);
                    probHTML += `
                        <div class="flex justify-between items-center">
                            <span class="font-semibold">${status}:</span>
                            <span class="font-bold text-lg">${count}/4 (${percentage}%)</span>
                        </div>
                    `;
                }
            });
            document.getElementById('probability').innerHTML = probHTML;

            // Calculate combined probability with sex
            calculateCombinedProbability(counts);

            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('simulationSection').style.display = 'block';
            document.getElementById('sexSection').style.display = 'block';
            resetSimulation();
        }

        function calculateCombinedProbability(diseaseCounts) {
            let combinedHTML = '';
            
            Object.entries(diseaseCounts).forEach(([status, count]) => {
                if (count > 0) {
                    const diseaseProb = count / 4;
                    const maleProb = diseaseProb * 0.5;
                    const femaleProb = diseaseProb * 0.5;
                    
                    // Male
                    combinedHTML += `
                        <div class="bg-blue-50 border-2 border-blue-300 rounded-lg p-3 text-center">
                            <div class="text-2xl mb-1">‚ôÇ</div>
                            <div class="font-bold text-sm">${status}</div>
                            <div class="text-xl font-bold text-blue-600">${(maleProb * 100).toFixed(1)}%</div>
                            <div class="text-xs text-gray-600">${count}/4 √ó 1/2</div>
                        </div>
                    `;
                    
                    // Female
                    combinedHTML += `
                        <div class="bg-pink-50 border-2 border-pink-300 rounded-lg p-3 text-center">
                            <div class="text-2xl mb-1">‚ôÄ</div>
                            <div class="font-bold text-sm">${status}</div>
                            <div class="text-xl font-bold text-pink-600">${(femaleProb * 100).toFixed(1)}%</div>
                            <div class="text-xs text-gray-600">${count}/4 √ó 1/2</div>
                        </div>
                    `;
                }
            });
            
            document.getElementById('combinedProbability').innerHTML = combinedHTML;
        }

        function hideResults() {
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('simulationSection').style.display = 'none';
            trials = [];
        }

        function simulateOnce() {
            const alleles1 = parent1.split('');
            const alleles2 = parent2.split('');
            
            const randomAllele1 = alleles1[Math.floor(Math.random() * 2)];
            const randomAllele2 = alleles2[Math.floor(Math.random() * 2)];
            
            const offspring = sortGenotype(randomAllele1 + randomAllele2);
            trials.push(offspring);
            
            updateTrialsDisplay();
        }

        function simulateMultiple() {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => simulateOnce(), i * 100);
            }
        }

        function resetSimulation() {
            trials = [];
            document.getElementById('trialsResults').style.display = 'none';
            document.getElementById('trialsList').innerHTML = '';
            document.getElementById('trialCount').textContent = '0';
        }

        function updateTrialsDisplay() {
            document.getElementById('trialsResults').style.display = 'block';
            document.getElementById('trialCount').textContent = trials.length;
            
            // Display trials
            const trialsHTML = trials.map((genotype, i) => {
                const pheno = getPhoenotype(genotype);
                return `
                    <div class="${pheno.color} border-2 rounded px-3 py-1 fade-in">
                        <span class="font-mono font-bold">${genotype}</span>
                    </div>
                `;
            }).join('');
            document.getElementById('trialsList').innerHTML = trialsHTML;

            // Calculate summary
            const results = calculatePunnett();
            const expectedCounts = { '‡∏õ‡∏Å‡∏ï‡∏¥': 0, '‡∏û‡∏≤‡∏´‡∏∞': 0, '‡∏õ‡πà‡∏ß‡∏¢': 0 };
            results.flat().forEach(genotype => {
                const pheno = getPhoenotype(genotype);
                expectedCounts[pheno.status]++;
            });

            const trialCounts = {};
            trials.forEach(genotype => {
                const pheno = getPhoenotype(genotype).status;
                trialCounts[pheno] = (trialCounts[pheno] || 0) + 1;
            });

            let summaryHTML = '';
            Object.keys(expectedCounts).forEach(status => {
                const count = trialCounts[status] || 0;
                const percentage = trials.length > 0 ? ((count / trials.length) * 100).toFixed(1) : 0;
                const expected = ((expectedCounts[status] / 4) * 100).toFixed(0);
                
                summaryHTML += `
                    <div class="text-center">
                        <p class="font-semibold text-gray-700">${status}</p>
                        <p class="text-2xl font-bold text-purple-600">${count}</p>
                        <p class="text-sm text-gray-600">${percentage}%</p>
                        <p class="text-xs text-gray-500">‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á: ${expected}%</p>
                    </div>
                `;
            });
            document.getElementById('trialsSummary').innerHTML = summaryHTML;
        }

        // Initialize on page load
        init();
    </script>
</body>
</html>